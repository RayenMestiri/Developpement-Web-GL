<!-- 
  Template BookForm - Formulaire template-driven
  Partie 3 - Point 9 : Structure du formulaire
  Partie 4 - Point 11 : Validations
  Partie 5 - Point 12 : Messages d'erreur
-->
<form #bookForm="ngForm" (ngSubmit)="onSubmit(bookForm)" class="book-form">
  
  <!-- Partie 3 - Point 10 : Champ Title -->
  <div class="form-group">
    <label for="title">Titre <span class="required">*</span></label>
    <input
      type="text"
      id="title"
      name="title"
      [(ngModel)]="book.title"
      #title="ngModel"
      required
      minlength="3"
      placeholder="Ex: Le Petit Prince"
      [class.error-field]="hasError(title)"
    />
    <!-- Partie 5 - Point 12 : Messages d'erreur -->
    @if (hasError(title)) {
      <div class="error-message">
        @if (title.errors?.['required']) {
          <span>‚ö†Ô∏è Le titre est obligatoire</span>
        }
        @if (title.errors?.['minlength']) {
          <span>‚ö†Ô∏è Le titre doit contenir au moins 3 caract√®res</span>
        }
      </div>
    }
  </div>

  <!-- Partie 3 - Point 10 : Champ Author -->
  <div class="form-group">
    <label for="author">Auteur <span class="required">*</span></label>
    <input
      type="text"
      id="author"
      name="author"
      [(ngModel)]="book.author"
      #author="ngModel"
      required
      minlength="3"
      placeholder="Ex: Antoine de Saint-Exup√©ry"
      [class.error-field]="hasError(author)"
    />
    @if (hasError(author)) {
      <div class="error-message">
        @if (author.errors?.['required']) {
          <span>‚ö†Ô∏è L'auteur est obligatoire</span>
        }
        @if (author.errors?.['minlength']) {
          <span>‚ö†Ô∏è Le nom de l'auteur doit contenir au moins 3 caract√®res</span>
        }
      </div>
    }
  </div>

  <!-- Partie 3 - Point 10 : Champ Publisher Email -->
  <div class="form-group">
    <label for="publisherEmail">Email de l'√©diteur <span class="required">*</span></label>
    <input
      type="email"
      id="publisherEmail"
      name="publisherEmail"
      [(ngModel)]="book.publisherEmail"
      #publisherEmail="ngModel"
      required
      email
      placeholder="Ex: editeur@example.com"
      [class.error-field]="hasError(publisherEmail)"
    />
    @if (hasError(publisherEmail)) {
      <div class="error-message">
        @if (publisherEmail.errors?.['required']) {
          <span>‚ö†Ô∏è L'email est obligatoire</span>
        }
        @if (publisherEmail.errors?.['email']) {
          <span>‚ö†Ô∏è L'email n'est pas valide</span>
        }
      </div>
    }
  </div>

  <!-- Partie 3 - Point 10 : Champ Publisher Phone -->
  <!-- Partie 4 - Point 11 : Pattern pour t√©l√©phone tunisien (8 chiffres) -->
  <div class="form-group">
    <label for="publisherPhone">T√©l√©phone de l'√©diteur</label>
    <input
      type="tel"
      id="publisherPhone"
      name="publisherPhone"
      [(ngModel)]="book.publisherPhone"
      #publisherPhone="ngModel"
      pattern="^[0-9]{8}$"
      placeholder="Ex: 71234567"
      [class.error-field]="hasError(publisherPhone)"
    />
    @if (hasError(publisherPhone)) {
      <div class="error-message">
        @if (publisherPhone.errors?.['pattern']) {
          <span>‚ö†Ô∏è Le t√©l√©phone doit contenir exactement 8 chiffres</span>
        }
      </div>
    }
  </div>

  <!-- Partie 3 - Point 10 : Champ Release Date -->
  <!-- Partie 4 - Point 11 : Validation > 1900 -->
  <div class="form-group">
    <label for="releaseDate">Date de sortie <span class="required">*</span></label>
    <input
      type="date"
      id="releaseDate"
      name="releaseDate"
      [(ngModel)]="book.releaseDate"
      #releaseDate="ngModel"
      required
      min="1900-01-01"
      [max]="getCurrentDate()"
      [class.error-field]="hasError(releaseDate)"
    />
    @if (hasError(releaseDate)) {
      <div class="error-message">
        @if (releaseDate.errors?.['required']) {
          <span>‚ö†Ô∏è La date de sortie est obligatoire</span>
        }
      </div>
    }
  </div>

  <!-- Partie 3 - Point 10 : Champ Category (select) -->
  <div class="form-group">
    <label for="category">Cat√©gorie <span class="required">*</span></label>
    <select
      id="category"
      name="category"
      [(ngModel)]="book.category"
      #category="ngModel"
      required
      [class.error-field]="hasError(category)"
    >
      <option value="" disabled>-- Choisir une cat√©gorie --</option>
      @for (cat of categories; track cat) {
        <option [value]="cat">{{ cat }}</option>
      }
    </select>
    @if (hasError(category)) {
      <div class="error-message">
        @if (category.errors?.['required']) {
          <span>‚ö†Ô∏è La cat√©gorie est obligatoire</span>
        }
      </div>
    }
  </div>

  <!-- Partie 3 - Point 10 : Champ Stock -->
  <!-- Partie 4 - Point 11 : Validation min=0 -->
  <div class="form-group">
    <label for="stock">Stock</label>
    <input
      type="number"
      id="stock"
      name="stock"
      [(ngModel)]="book.stock"
      #stock="ngModel"
      min="0"
      placeholder="Ex: 10"
      [class.error-field]="hasError(stock)"
    />
    @if (hasError(stock)) {
      <div class="error-message">
        @if (stock.errors?.['min']) {
          <span>‚ö†Ô∏è Le stock ne peut pas √™tre n√©gatif</span>
        }
      </div>
    }
  </div>

  <!-- Partie 3 - Point 10 : Champ isAvailable (checkbox) -->
  <div class="form-group checkbox-group">
    <label>
      <input
        type="checkbox"
        id="isAvailable"
        name="isAvailable"
        [(ngModel)]="book.isAvailable"
      />
      <span>Disponible √† la vente</span>
    </label>
  </div>

  <!-- Boutons d'action -->
  <div class="form-actions">
    <!-- Partie 9 - Point 18 : Changer le bouton selon le mode -->
    @if (isEditMode) {
      <button type="submit" class="btn btn-primary" [disabled]="!bookForm.valid">
        ‚úèÔ∏è Mettre √† jour
      </button>
      <button type="button" class="btn btn-secondary" (click)="cancelEdit()">
        ‚ùå Annuler
      </button>
    } @else {
      <button type="submit" class="btn btn-primary" [disabled]="!bookForm.valid">
        ‚ûï Ajouter
      </button>
      <button type="button" class="btn btn-secondary" (click)="resetForm(bookForm)">
        üîÑ R√©initialiser
      </button>
    }
  </div>

  <!-- √âtat du formulaire (pour debug) -->
  <div class="form-status">
    <small>
      √âtat : 
      @if (bookForm.valid) {
        <span class="status-valid">‚úÖ Valide</span>
      } @else {
        <span class="status-invalid">‚ùå Invalide</span>
      }
    </small>
  </div>
</form>
